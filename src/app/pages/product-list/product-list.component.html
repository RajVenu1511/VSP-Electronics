<div class="product-list-page">
  <!-- Breadcrumb -->
  <div class="breadcrumb-section">
    <div class="container">
      <nav class="breadcrumb">
        <a routerLink="/">Home</a> / 
        <ng-container *ngIf="!categoryName || categoryName === 'All Products' || categoryName === 'Shop'">
          <span>Shop</span>
        </ng-container>
        <ng-container *ngIf="categoryName && categoryName !== 'All Products' && categoryName !== 'Shop'">
          <ng-container *ngIf="categoryName.includes('/')">
            <a routerLink="/category/raspberry">Raspberry Pi Boards</a> / 
            <span>RPI Accessories</span>
          </ng-container>
          <ng-container *ngIf="!categoryName.includes('/')">
            <span>{{ categoryName }}</span>
          </ng-container>
        </ng-container>
      </nav>
    </div>
  </div>

  <!-- Categories Grid View (shown on /shop) -->
  <div *ngIf="showCategories" class="categories-view">
    <div class="category-header">
      <div class="container">
        <h1 class="category-title">Shop</h1>
        <p class="product-count">Showing all {{ brandFilter ? filteredProducts.length : categories.length }} results</p>
      </div>
    </div>

    <div class="container">
      <div class="categories-grid">
        <a *ngFor="let category of categories; trackBy: trackByCategoryId" 
           [routerLink]="['/category', category.slug]" 
           class="category-card">
          <div class="category-image">
            <img [src]="category.image" 
                 [alt]="category.name"
                 onerror="this.src='assets/images/placeholder.jpg'">
          </div>
          <div class="category-info">
            <h3>{{ category.name }}</h3>
            <p>{{ category.productCount }} products</p>
          </div>
        </a>
      </div>
    </div>

    <!-- Show filtered products below categories when brand filter is active -->
    <div *ngIf="brandFilter && filteredProducts.length > 0" class="container" style="margin-top: 40px;">
      <div class="product-grid">
        <app-product-card 
          *ngFor="let product of filteredProducts; trackBy: trackByProductId" 
          [product]="product"
          (loginRequired)="onLoginRequired($event)">
        </app-product-card>
      </div>
    </div>
  </div>

  <!-- Products View (shown when category or brand filter is active) -->
  <div *ngIf="!showCategories">
  <!-- Category Header -->
  <div class="category-header">
    <div class="container">
      <h1 class="category-title">{{ getCategoryDisplayName() }}</h1>
      <p class="product-count">Showing {{ filteredProducts.length}} products</p>
    </div>
  </div>

  <!-- Subcategories -->
  <div class="subcategories-section" *ngIf="currentCategory && currentCategory.subcategories && currentCategory.subcategories.length > 0">
    <div class="container">
      <div class="subcategories-grid">
        <a *ngFor="let subcat of currentCategory.subcategories" 
           [routerLink]="['/category', currentCategory.slug + '/' + subcat.slug]" 
           class="subcategory-card">
          <div class="subcategory-image">
            <img [src]="subcat.image || 'assets/images/placeholder.jpg'" 
                 [alt]="subcat.name"
                 onerror="this.src='assets/images/placeholder.jpg'">
          </div>
          <div class="subcategory-info">
            <h3>{{ subcat.name }}</h3>
            <p>{{ subcat.productCount }} products</p>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Category Description -->
  <div class="category-description" *ngIf="categoryDescription">
    <div class="container">
      <p>{{ categoryDescription }}</p>
    </div>
  </div>

  <div class="container">
    <div class="products-container">
      <div class="filters-sidebar">
        <div class="filter-section">
          <h3>Categories</h3>
          <ul class="filter-list">
            <li><a routerLink="/shop">All Products</a></li>
            <li><a routerLink="/category/robotic-diy-kits">Robotic DIY Kits</a></li>
            <li><a routerLink="/category/ready-running-projects">Ready Running Projects</a></li>
            <li><a routerLink="/category/raspberry">Raspberry Pi</a></li>
            <li style="padding-left: 15px;"><a routerLink="/category/raspberry/rpi-accessories">- RPI Accessories</a></li>
            <li><a routerLink="/category/mini-drone-kits">Mini Drone Kits</a></li>
            <li><a routerLink="/category/diy-kits">DIY Kits</a></li>
            <li><a routerLink="/category/bonka">Bonka Batteries</a></li>
          </ul>
        </div>

        <div class="filter-section">
          <h3>Price Range</h3>
          <ul class="filter-list">
            <li><a href="#">Under ₹1000</a></li>
            <li><a href="#">₹1000 - ₹3000</a></li>
            <li><a href="#">₹3000 - ₹5000</a></li>
            <li><a href="#">Above ₹5000</a></li>
          </ul>
        </div>

        <div class="filter-section">
          <h3>Brand</h3>
          <ul class="filter-list">
            <li><a href="#">ACEBOTT</a></li>
            <li><a href="#">Arduino</a></li>
            <li><a href="#">BONKA</a></li>
            <li><a href="#">Raspberry Pi</a></li>
            <li><a href="#">EMAX</a></li>
          </ul>
        </div>
      </div>

      <div class="products-main">
        <div class="products-toolbar">
          <div class="view-options">
            <button class="view-btn active"><i class="fas fa-th"></i></button>
            <button class="view-btn"><i class="fas fa-list"></i></button>
          </div>

          <div class="sort-options">
            <label>Sort By:</label>
            <select (change)="onSortChange($event)" [value]="sortBy">
              <option value="default">Default</option>
              <option value="name">Name</option>
              <option value="price-low">Price: Low to High</option>
              <option value="price-high">Price: High to Low</option>
            </select>
          </div>
        </div>

        <div class="product-grid" *ngIf="filteredProducts.length > 0">
          <app-product-card 
            *ngFor="let product of filteredProducts; trackBy: trackByProductId" 
            [product]="product"
            (loginRequired)="onLoginRequired($event)">
          </app-product-card>
        </div>

        <div class="no-products" *ngIf="filteredProducts.length === 0">
          <i class="fas fa-box-open"></i>
          <h3>No products found</h3>
          <p>Try adjusting your filters or search criteria</p>
        </div>
      </div>
    </div>
  </div>
  </div>

<!-- Auth Modal -->
<app-auth-modal *ngIf="showAuthModal" [message]="authModalMessage" (close)="closeAuthModal()"></app-auth-modal>
</div>
